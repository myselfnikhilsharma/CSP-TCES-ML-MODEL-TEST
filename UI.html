<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thermal System Estimator</title>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      position: relative;
      transition: background-color 0.3s, color 0.3s;
      background-image: url("CST.jpg");
      background-size: 100% 50%;
      background-position: center;
      background-repeat: no-repeat;
    }


    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.35);
      z-index: 0;
    }

    /* Main container styles */
    .container {
      position: relative;
      z-index: 1; /* Above overlay */
      background-color: rgba(249, 249, 249, 0.95);
      width: 100%;
      max-width: 500px;
      border-radius: 16px;
      padding: 30px 25px;
      box-shadow: 0 0 15px rgba(0, 128, 0, 0.3);
      transition: background-color 0.3s;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2e7d32;
      font-weight: 600;
    }

    label {
      font-weight: 600;
      margin-top: 8px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
    }

    .actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    button {
      flex: 1;
      padding: 12px;
      background: #2e7d32;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    button:disabled {
      background: gray;
    }

    #prediction {
      margin-top: 18px;
      font-size: 18px;
      font-weight: bold;
      color: #2e7d32;
      text-align: center;
      min-height: 1.5em;
    }

    .error { color: red; font-weight: bold; }
    .loading { color: orange; font-weight: bold; }

  </style>
</head>
<body>

  <div class="container">
    <h2>Thermal Energy System Estimator</h2>

    <form id="predictionForm" novalidate>

      <label>Prediction Type</label>
      <select id="model_choice" name="model_choice" required>
        <option value="" disabled selected>Select Prediction Type</option>
        <option value="LCOE">LCOE (Multiple Outputs)</option>
        <option value="TES">ESC (Single Output)</option> 

      </select>

      <label for="f1">Equilibrium Temperature (K)</label>
      <input type="text" id="f1" name="f1" placeholder="Equilibrium Temperature (K)" required />
      
      <label for="f2">Heat of Reaction (kJ/mol)</label>
      <input type="text" id="f2" name="f2" step="0.0000001" placeholder="Heat of Reaction (kJ/mol)" required />
      
      <label for="f3">Specific Heat Capacity of A (kJ/kg-K)</label>
      <input type="text" id="f3" name="f3" step="0.0000001" min="0" placeholder="Specific Heat Capacity of A (kJ/kg-K)" required />
      
      <label for="f4">Specific Heat Capacity of B (kJ/kg-K)</label>
      <input type="text" id="f4" name="f4" step="0.0000001" min="0" placeholder="Specific Heat Capacity of B (kJ/kg-K)" required />
      
      <label for="f5">Density of A (g/cm続)</label>
      <input type="text" id="f5" name="f5" step="0.0000001" min="0" placeholder="Density of A (g/cm続)" required />
      
      <label for="f6">Density of B (g/cm続)</label>
      <input type="text" id="f6" name="f6" step="0.0000001" min="0" placeholder="Density of B (g/cm続)" required />
      
      <label for="f7">Price ($/MT)</label>
      <input type="text" id="f7" name="f7" step="0.0000001" min="0" placeholder="Price ($/MT)" required />
      
      <label for="f8">Stoichiometric Coefficient of C</label>
      <input type="text" id="f8" name="f8" step="0.0000001" placeholder="Stoichiometric Coeff. of C" required />
      
      <label for="f9">Molecular Weight of A (g/mol)</label>
      <input type="text" id="f9" name="f9" step="0.0000001" min="0" placeholder="Molecular Weight of A (g/mol)" required />

      <div class="actions">
        <button type="submit" id="submitBtn" disabled>Estimate</button>
        <button type="button" id="clearBtn">Clear</button>
      </div>

    </form>

    <div id="prediction"></div>
    <canvas id="barChart" style="margin-top:20px; width:100%; height:300px;"></canvas>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const form = document.getElementById("predictionForm");
    const submitBtn = document.getElementById("submitBtn");
    const clearBtn = document.getElementById("clearBtn");
    const output = document.getElementById("prediction");

    // Enable submit button only when valid
    form.addEventListener("input", () => {
      submitBtn.disabled = !form.checkValidity();
    });

    // Clear form
    clearBtn.addEventListener("click", () => {
      form.reset();
      output.textContent = "";
      submitBtn.disabled = true;
    });

    // Submit form
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;

      output.textContent = "Estimating...";
      output.className = "loading";

      const formData = new FormData(form);
      const params = new URLSearchParams();
      formData.forEach((v, k) => params.append(k, v));

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: params
        });

        const result = await res.json();
        output.className = "";

        // --- CASE 1: MULTIPLE OUTPUTS ---
        if (result.predictions) {
          output.innerHTML = "<b>Results:</b><br><br>";
          for (const key in result.predictions) {
            output.innerHTML += `${key}: ${result.predictions[key]} $/kWh<br>`;
          }
          // --- BAR CHART LOGIC ---
          const labels = Object.keys(result.predictions);
          const values = Object.values(result.predictions);

          // Destroy old chart if exists
      	  if (window.myBarChart) {
            window.myBarChart.destroy();
          }
          const ctx = document.getElementById("barChart").getContext("2d");
          window.myBarChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: labels,
              datasets: [{
                label: "Model Outputs ($/kWh)",
                data: values,
                borderWidth: 1
               }]
             },
             options: {
               responsive: true,
               scales: {
                 y: { beginAtZero: true }
               }
             }
           });
        }

        // --- CASE 2: SINGLE OUTPUT ---
        else if (result.prediction !== undefined) {
          output.textContent = `Estimated Value: ${result.prediction} $/kWh`;
        }

        // ERROR
        else {
          output.textContent = "Error: " + result.error;
          output.className = "error";
        }

      } catch (err) {
        output.textContent = "Prediction failed.";
        output.className = "error";
      }

      submitBtn.disabled = false;
    });
  </script>

</body>
</html>

